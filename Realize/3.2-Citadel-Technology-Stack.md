---
title: "Citadel V2 Technology Stack"
date: "2025-09-28"
type: "technology-stack"
phase: "realize"
status: "active"
version: "3.2"
---

# Citadel V2 Technology Stack

**Document Purpose:** Define the comprehensive technology stack for Citadel V2, including frameworks, libraries, tools, and infrastructure components with version specifications and rationale.

**Stack Date:** 2025-09-28  
**Architecture Team:** HX Data Ingestion Project  
**Status:** Active - Implementation Ready  
**Related Documents:** System Architecture v3.1, Constitution v1.0, Implementation Plan v2.0

---

## Executive Summary

The Citadel V2 technology stack represents a modern, production-ready selection of technologies chosen for performance, reliability, and enterprise readiness. All selections align with constitutional principles including agent-first architecture, zero technical debt, security-by-design, and production readiness.

### Stack Selection Principles

1. **Production Proven** - Technologies with established track records in enterprise environments
2. **Active Maintenance** - Regular updates, security patches, and community support
3. **Performance Optimized** - High throughput, low latency capabilities
4. **Scalability First** - Horizontal and vertical scaling capabilities
5. **Security Hardened** - Built-in security features and compliance support

---

## Core Runtime & Languages

### Python 3.12
**Purpose:** Primary application runtime for all backend services

**Rationale:**
- Latest stable Python release with performance improvements
- Async/await native support for I/O-bound operations
- Rich ecosystem for AI/ML, data processing, and web services
- Type hints and static analysis support for code quality

**Key Features:**
- PEP 701: f-string improvements for better performance
- Improved error messages for faster debugging
- Per-interpreter GIL for better concurrency
- Faster import times and reduced memory usage

**Version:** `3.12.x` (latest stable)

**Package Management:**
- **pip** (24.x) - Package installer
- **uv** (0.4.x) - Ultra-fast Python package installer
- **poetry** (1.8.x) - Dependency management and packaging

---

## Frontend Stack

### Open Web-UI
**Purpose:** Primary user interface framework

**Technology:** React-based web application framework  
**Version:** Latest stable release

**Core Components:**
- **React 18.x** - UI component library with concurrent features
- **TypeScript 5.x** - Type-safe JavaScript for robust development
- **Vite 5.x** - Fast build tool and development server
- **TailwindCSS 3.x** - Utility-first CSS framework

**State Management:**
- **Zustand 4.x** - Lightweight state management
- **TanStack Query 5.x** - Server state management and caching

**Real-Time Communication:**
- **Socket.io-client 4.x** - WebSocket communication
- **LiveKit Client SDK** - Real-time collaboration features

**UI Components:**
- **Radix UI** - Accessible component primitives
- **shadcn/ui** - Re-usable component library
- **Lucide React** - Icon library

**Development Tools:**
- **ESLint 9.x** - Code linting and standards enforcement
- **Prettier 3.x** - Code formatting
- **Vitest 2.x** - Unit testing framework
- **Playwright 1.x** - End-to-end testing

---

## Backend Framework

### FastAPI
**Purpose:** Web framework for building APIs

**Version:** `0.115.x`

**Rationale:**
- Native async/await support for high concurrency
- Automatic API documentation (OpenAPI/Swagger)
- Pydantic integration for data validation
- High performance (comparable to Node.js and Go)
- Excellent type hint support

**Key Dependencies:**
- **Uvicorn 0.31.x** - ASGI server implementation
- **Gunicorn 23.x** - Process manager for production
- **Starlette 0.38.x** - ASGI framework foundation
- **Pydantic 2.9.x** - Data validation and settings

**Extensions:**
- **FastAPI-Users** - Authentication and user management
- **FastAPI-Limiter** - Rate limiting middleware
- **FastAPI-Cache** - Response caching
- **FastAPI-CORS** - Cross-origin resource sharing

---

## AI & Agent Framework

### Pydantic-AI
**Purpose:** Agent framework for intelligent processing

**Version:** `0.0.14` (latest)

**Rationale:**
- Type-safe agent definitions with Pydantic models
- Natural language interface support
- Tool-based architecture for reusability
- Multi-LLM provider support
- Structured output with validation

**Integration:**
- **OpenAI SDK 1.x** - GPT model integration
- **Anthropic SDK 0.39.x** - Claude model integration
- **Cohere SDK 5.x** - Command model integration
- **Groq SDK 0.11.x** - Fast inference integration

### LiteLLM
**Purpose:** Unified LLM interface and router

**Version:** `1.51.x`

**Rationale:**
- Single API for 100+ LLM providers
- Automatic fallback and load balancing
- Cost tracking and token usage monitoring
- Streaming response support
- Prompt template management

**Features:**
- Provider abstraction layer
- Request retry logic
- Response caching
- Cost optimization
- Multi-model routing

---

## Vector Database

### Qdrant
**Purpose:** High-performance vector similarity search

**Version:** `1.12.x`

**Rationale:**
- Purpose-built for vector search operations
- Distributed architecture for horizontal scaling
- Sub-100ms search latency
- Collection-based multi-tenancy
- Rich metadata filtering capabilities

**Client Library:**
- **qdrant-client 1.12.x** - Python client library

**Configuration:**
- **Storage:** On-disk with mmap for large datasets
- **Indexing:** HNSW (Hierarchical Navigable Small World)
- **Distance Metric:** Cosine similarity
- **Sharding:** By collection for horizontal scaling
- **Replication:** Factor of 3 for high availability

**Features:**
- Payload-based filtering
- Scroll API for large result sets
- Snapshot and backup capabilities
- Cluster management API
- Prometheus metrics export

---

## Relational Database

### PostgreSQL 17
**Purpose:** Primary relational data store

**Version:** `17.x` (latest stable)

**Rationale:**
- Advanced features (JSONB, full-text search, partitioning)
- Excellent performance and reliability
- Strong ACID compliance
- Rich extension ecosystem
- Proven at enterprise scale

**Key Extensions:**
- **pg_stat_statements** - Query performance monitoring
- **pgaudit** - Comprehensive audit logging
- **pg_partman** - Partition management
- **pg_cron** - Job scheduling
- **timescaledb** - Time-series data optimization

**Connection Pooling:**
- **PgBouncer 1.23.x** - Connection pooling layer
- **Psycopg3 3.2.x** - PostgreSQL adapter for Python

**ORM & Query Builder:**
- **SQLAlchemy 2.0.x** - Python SQL toolkit and ORM
- **Alembic 1.13.x** - Database migration tool

**Backup & Recovery:**
- **pgBackRest 2.53.x** - Backup and restore solution
- **WAL-G 3.x** - WAL archiving and recovery

---

## Caching Layer

### Redis
**Purpose:** In-memory data store for caching and sessions

**Version:** `7.4.x` (latest stable)

**Rationale:**
- Sub-millisecond latency for cache operations
- Rich data structures (strings, hashes, lists, sets, sorted sets)
- Pub/Sub for real-time messaging
- Persistence options (RDB, AOF)
- Cluster mode for horizontal scaling

**Client Library:**
- **redis-py 5.1.x** - Python Redis client
- **hiredis 3.0.x** - High-performance Redis parser

**Features:**
- Session storage with TTL
- Query result caching
- Rate limiting counters
- Real-time analytics aggregation
- Pub/Sub for event distribution

**Configuration:**
- **Deployment:** Redis Cluster (3 master + 3 replica)
- **Persistence:** AOF (Append Only File) + RDB snapshots
- **Eviction:** LRU (Least Recently Used)
- **Max Memory:** 16GB per node

---

## Message Queue & Event Bus

### AG-UI Event Bus
**Purpose:** Real-time event streaming and collaboration

**Technology Stack:**
- **Apache Kafka 3.8.x** - Distributed event streaming platform
- **Redis Streams** - Lightweight message queuing
- **WebSocket (via Socket.io 4.x)** - Real-time client communication

**Client Libraries:**
- **aiokafka 0.11.x** - Async Kafka client for Python
- **confluent-kafka-python 2.5.x** - Confluent Kafka client

**Features:**
- Event persistence and replay
- Partitioning for scalability
- Consumer groups for load distribution
- Schema registry for event contracts
- Metrics and monitoring integration

**Event Protocol:**
- **JSON Schema** - Event structure validation
- **CloudEvents** - Standardized event format
- **Protobuf** - Binary event serialization (optional)

---

## Authentication & Authorization

### Clerk
**Purpose:** Enterprise authentication and authorization

**Version:** `5.77.0`

**Rationale:**
- Enterprise SSO support (SAML, OIDC)
- Multi-factor authentication built-in
- Role-based access control
- Audit logging and compliance
- React and API SDKs

**Integration:**
- **Clerk JavaScript SDK** - Frontend integration
- **Clerk Python SDK** - Backend verification
- **Clerk WebHooks** - User lifecycle events

**Features:**
- User management and profiles
- Social login providers
- Passwordless authentication
- Session management
- Organization and team support

**Security:**
- JWT token-based authentication
- Automatic token refresh
- CSRF protection
- Rate limiting
- Brute force protection

---

## Real-Time Communication

### LiveKit
**Purpose:** WebRTC-based real-time collaboration

**Version:** Latest stable release

**Rationale:**
- Low-latency WebRTC communication
- Voice and video integration
- Screen sharing capabilities
- Scalable infrastructure
- Client SDKs for multiple platforms

**Components:**
- **LiveKit Server** - Media router and SFU
- **LiveKit Client SDK** - Frontend integration
- **LiveKit Server SDK** - Backend integration

**Features:**
- Voice-to-text transcription
- Real-time data channels
- Multi-party collaboration
- Bandwidth optimization
- Recording capabilities

---

## Web Crawling & Content Processing

### Crawl4AI
**Purpose:** Intelligent web crawling and content extraction

**Version:** `0.4.x`

**Rationale:**
- Async-first architecture
- Playwright integration for dynamic content
- Smart content extraction
- Memory-adaptive batching
- Markdown conversion

**Dependencies:**
- **Playwright 1.48.x** - Browser automation
- **BeautifulSoup4 4.12.x** - HTML parsing
- **lxml 5.3.x** - XML/HTML processing
- **html2text 2024.x** - HTML to Markdown conversion

**Features:**
- JavaScript rendering support
- Cookie and session management
- Proxy support
- Rate limiting and politeness
- robots.txt compliance

---

## Embedding & NLP

### Sentence Transformers
**Purpose:** Generate text embeddings for semantic search

**Version:** `3.2.x`

**Rationale:**
- State-of-the-art sentence embeddings
- Multi-language support
- Pre-trained models available
- Fine-tuning capabilities
- Fast inference

**Models:**
- **all-MiniLM-L6-v2** - Fast, balanced performance (384 dimensions)
- **all-mpnet-base-v2** - High quality (768 dimensions)
- **multilingual-e5-large** - Multi-language support

**Dependencies:**
- **transformers 4.46.x** - Hugging Face transformers
- **torch 2.5.x** - PyTorch deep learning framework
- **tokenizers 0.20.x** - Fast tokenization

---

## Monitoring & Observability

### Structured Logging
**Purpose:** Comprehensive application logging

**Stack:**
- **structlog 24.4.x** - Structured logging for Python
- **python-json-logger 3.2.x** - JSON log formatting
- **Loki** - Log aggregation and storage
- **Grafana** - Log visualization and analysis

**Features:**
- Correlation ID tracking
- Structured log formatting (JSON)
- Log level management
- Context preservation
- Performance tracking

### Metrics Collection
**Purpose:** System and application metrics

**Stack:**
- **Prometheus 2.54.x** - Metrics collection and storage
- **prometheus-client 0.21.x** - Python Prometheus client
- **Grafana 11.x** - Metrics visualization
- **AlertManager 0.27.x** - Alert routing and management

**Metrics:**
- Request latency (P50, P95, P99)
- Request rate and throughput
- Error rates and types
- Resource utilization
- Business metrics (acquisitions, queries, users)

### Distributed Tracing
**Purpose:** End-to-end request tracing

**Stack:**
- **OpenTelemetry 1.27.x** - Tracing framework
- **opentelemetry-instrumentation 0.48.x** - Auto-instrumentation
- **Jaeger 1.62.x** - Trace collection and visualization
- **Tempo 2.6.x** - Trace storage backend

**Features:**
- Automatic instrumentation for FastAPI
- Correlation with logs and metrics
- Service dependency mapping
- Performance bottleneck identification
- Error root cause analysis

---

## Testing Framework

### Unit Testing
**Stack:**
- **pytest 8.3.x** - Testing framework
- **pytest-asyncio 0.24.x** - Async test support
- **pytest-cov 6.0.x** - Code coverage reporting
- **pytest-mock 3.14.x** - Mocking support

**Additional Tools:**
- **Faker 30.x** - Test data generation
- **Factory Boy 3.3.x** - Test fixture creation
- **hypothesis 6.115.x** - Property-based testing

### Integration Testing
**Stack:**
- **pytest-integration 0.2.x** - Integration test support
- **testcontainers 4.8.x** - Docker-based integration tests
- **responses 0.25.x** - HTTP request mocking
- **aioresponses 0.7.x** - Async HTTP mocking

### End-to-End Testing
**Stack:**
- **Playwright 1.48.x** - Browser automation
- **pytest-playwright 0.6.x** - Playwright pytest integration

### Performance Testing
**Stack:**
- **Locust 2.32.x** - Load testing framework
- **k6** - Performance testing tool

---

## Development Tools

### Code Quality
**Stack:**
- **ruff 0.7.x** - Fast Python linter and formatter
- **mypy 1.13.x** - Static type checking
- **black 24.10.x** - Code formatter (fallback)
- **isort 5.13.x** - Import sorting
- **bandit 1.7.x** - Security issue detection

### Pre-commit Hooks
**Stack:**
- **pre-commit 4.0.x** - Git hook framework
- **commitizen 3.29.x** - Commit message standards

### Documentation
**Stack:**
- **MkDocs 1.6.x** - Documentation site generator
- **mkdocs-material 9.5.x** - Material theme
- **mkdocstrings 0.26.x** - API documentation from docstrings

### API Documentation
**Stack:**
- **OpenAPI 3.1** - API specification standard
- **Swagger UI** - Interactive API documentation
- **ReDoc** - API documentation alternative

---

## Infrastructure & DevOps

### Container Platform
**Stack:**
- **Docker 27.x** - Container runtime
- **Docker Compose 2.29.x** - Multi-container orchestration
- **Kubernetes 1.31.x** - Container orchestration (production)

### Container Registry
**Stack:**
- **Harbor 2.11.x** - Private container registry
- **Trivy 0.56.x** - Container vulnerability scanning

### Infrastructure as Code
**Stack:**
- **Ansible 2.17.x** - Configuration management
- **Terraform 1.9.x** - Infrastructure provisioning
- **HX Infrastructure Management** - Custom automation framework

**Ansible Collections:**
- **ansible.builtin** - Core modules
- **community.general** - General modules
- **community.docker** - Docker integration
- **community.postgresql** - PostgreSQL management

### CI/CD Pipeline
**Stack:**
- **GitHub Actions** - CI/CD automation
- **GitLab CI** - Alternative CI/CD
- **ArgoCD 2.12.x** - GitOps deployment

**Pipeline Stages:**
1. Code quality checks (linting, formatting)
2. Unit tests with coverage
3. Integration tests
4. Security scanning
5. Container image build
6. Deployment to staging
7. E2E tests
8. Deployment to production

### Secrets Management
**Stack:**
- **HashiCorp Vault 1.17.x** - Secret management
- **ansible-vault** - Encrypted variable storage
- **git-crypt 0.7.x** - Git repository encryption

---

## Security Tools

### Security Scanning
**Stack:**
- **Trivy 0.56.x** - Vulnerability scanning
- **Safety 3.2.x** - Python dependency vulnerability checking
- **Bandit 1.7.x** - Python code security analysis
- **Gitleaks 8.20.x** - Secret scanning in git

### Network Security
**Stack:**
- **nginx 1.27.x** - Reverse proxy and load balancer
- **ModSecurity 3.x** - Web application firewall
- **Fail2Ban 1.1.x** - Intrusion prevention

### TLS/SSL
**Stack:**
- **Let's Encrypt** - Free SSL certificates
- **cert-manager 1.16.x** - Kubernetes certificate management
- **mTLS** - Mutual TLS for service-to-service communication

---

## Data Processing

### Content Processing
**Stack:**
- **markdownify 0.13.x** - HTML to Markdown conversion
- **pypdf 5.0.x** - PDF text extraction
- **python-docx 1.1.x** - Word document processing
- **openpyxl 3.1.x** - Excel file processing

### Text Processing
**Stack:**
- **spaCy 3.8.x** - NLP library
- **nltk 3.9.x** - Natural language toolkit
- **langdetect 1.0.x** - Language detection
- **chardet 5.2.x** - Character encoding detection

---

## Dependency Management

### Core Dependencies Summary

**Total Dependencies:** ~150-200 packages (optimized from V1's 204)

**Dependency Categories:**
- **Core Runtime:** Python 3.12, FastAPI, Uvicorn
- **AI/ML:** Pydantic-AI, LiteLLM, Sentence Transformers, Torch
- **Data Stores:** Qdrant, PostgreSQL, Redis clients
- **Web:** Crawl4AI, Playwright, BeautifulSoup4
- **Testing:** pytest, Playwright, Locust
- **DevOps:** Ansible, Docker, monitoring tools
- **Security:** Clerk, Vault, security scanning tools

**Version Pinning Strategy:**
- Pin major and minor versions for stability
- Allow patch version updates for security fixes
- Regular dependency audits (weekly)
- Automated dependency updates with testing

---

## Migration from V1

### Key Technology Changes

| Component | V1 (As-Is) | V2 (To-Be) | Rationale |
|-----------|------------|------------|-----------|
| Vector DB | ChromaDB | Qdrant | Production scalability, distributed architecture |
| LLM Client | OpenAI/Anthropic direct | LiteLLM | Unified interface, multi-provider support |
| Web UI | Streamlit | Open Web-UI | Enhanced UX, production-ready |
| Python | 3.11+ | 3.12 | Latest features, performance improvements |
| Hosting | Local Machine | Orchestration Server | Production deployment, scalability |

### Migration Path

**Phase 1: Foundation (Weeks 1-4)**
- Set up Python 3.12 environment
- Deploy Qdrant cluster
- Configure PostgreSQL 17
- Implement Redis caching layer

**Phase 2: Core Services (Weeks 5-8)**
- Migrate to FastAPI framework
- Integrate Pydantic-AI agents
- Implement LiteLLM router
- Deploy AG-UI event bus

**Phase 3: Frontend & Integration (Weeks 9-12)**
- Migrate to Open Web-UI
- Integrate Clerk authentication
- Implement LiveKit collaboration
- Deploy monitoring stack

---

## Performance Optimization

### Database Optimization
- Connection pooling (100 connections for PostgreSQL)
- Query result caching with Redis
- Index optimization for common queries
- Partitioning for large tables
- Read replicas for query load

### Application Optimization
- Async/await for I/O-bound operations
- Connection pooling for external services
- Response caching for expensive operations
- Request batching for bulk operations
- Lazy loading for large datasets

### Network Optimization
- HTTP/2 for improved performance
- Response compression (gzip, brotli)
- CDN for static assets
- WebSocket for real-time updates
- Connection keep-alive

---

## Conclusion

The Citadel V2 technology stack represents a modern, production-ready foundation for enterprise-grade data ingestion and RAG capabilities. All technology selections align with constitutional principles and provide robust capabilities for scalability, security, and operational excellence.

**Key Stack Strengths:**
- **Modern & Proven** - Latest stable versions of established technologies
- **Performance Optimized** - High throughput, low latency capabilities
- **Scalable Architecture** - Horizontal and vertical scaling support
- **Security Hardened** - Comprehensive security controls and compliance
- **Operationally Excellent** - Complete observability and monitoring

---

**Document Control**
- **Version:** 3.2
- **Status:** Active - Implementation Ready
- **Next Review:** Upon completion of Phase 1 implementation
- **Related Documents:** System Architecture v3.1, Constitution v1.0, Implementation Plan v2.0
